{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"{ default: Vue }\"","webpack:///./src/report-row-extensions.ts","webpack:///./src/index.ts","webpack:///./src/bond-row-component.ts","webpack:///./src/load-report.ts","webpack:///./src/settings.ts","webpack:///./src/adjust-font.ts","webpack:///./src/monitor-resize.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","default","Vue","isVarCoupon","row","couponValues","length","indexOf","hasOffer","v","vue_1","load_report_1","report_row_extensions_1","settings_1","adjust_font_1","monitor_resize_1","LAUNCH_TIME","Date","now","VM","collapseForm","window","matchMedia","matches","applySettings","save","settings","maturityHorizon","year","month","join","maxListLevel","Number","maxPerYear","requiredCouponMonth","maxAmort","minTotalTradesPerc","couponType","allowVarCoupon","allowOffer","hasFits","hasABI","showVarCouponNotice","showOfferNotice","_i","_a","reportRows","fits","inABI","maturityDate","sector1","sector2","sector3","sector","listLevel","couponMonths","minDaysBetweenAmort","totalTradesPerc","onCordovaResume","location","reload","document","addEventListener","report","load","reportDate","date","rows","el","data","watch","deep","handler","getElementById","style","display","component","props","template","computed","moexUrl","this","isin","sectorBadgeClass","PILL_BADGE_CLASS_PREFIX","sectorName","listLevelBadgeClass","listLevelName","showCouponStar","REPORT_URL","callback","xhr","XMLHttpRequest","handleError","alert","open","timeout","onreadystatechange","readyState","status","source","cols","cols_1","name_1","String","map","list_level","total_trades_perc","maturity_date","min_days_between_amort","coupon_months","coupon_values","closeYield","close_yield","Boolean","in_abi","convert","JSON","parse","responseText","send","STORAGE_KEY","DEFAULT_SETTINGS","getFullYear","storedSettings","result","__assign","localStorage","getItem","_b","keys","setItem","stringify","html","documentElement","GUTTERS","helperElement","fontSize","containerWidth","parentElement","clientWidth","helperWidth","scrollWidth","callbacks","prevW","w","callbacks_1","push"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","module.exports = { default: Vue };","import IReportRow from \"./report-row\";\r\n\r\nexport function isVarCoupon(row: IReportRow) {\r\n    return row.couponValues.length > 1\r\n        || row.name.indexOf(\"ОФЗ-ПК \") === 0;\r\n}\r\n\r\nexport function hasOffer(row: IReportRow) {\r\n    const v = row.couponValues;\r\n    return v[v.length - 1] === null;\r\n}\r\n","import Vue from \"vue\";\r\nimport \"./bond-row-component\";\r\nimport loadReport from \"./load-report\";\r\nimport IReportRow from \"./report-row\";\r\nimport { hasOffer, isVarCoupon } from \"./report-row-extensions\";\r\nimport { ISettings, load as loadSettings, save as saveSettings } from \"./settings\";\r\n\r\nimport adjustFont from \"./adjust-font\";\r\nimport monitorResize from \"./monitor-resize\";\r\n\r\ninterface IViewModel {\r\n    settings?: ISettings;\r\n    reportDate?: string;\r\n    reportRows?: ReadonlyArray<IReportRow>;\r\n    hasFits?: boolean;\r\n    hasABI?: boolean;\r\n    collapseForm?: boolean;\r\n    showVarCouponNotice?: boolean;\r\n    showOfferNotice?: boolean;\r\n}\r\n\r\nconst LAUNCH_TIME = Date.now();\r\nconst ROOT_ID = \"vue-root\";\r\n\r\nconst VM: IViewModel = {\r\n    collapseForm: window.matchMedia && window.matchMedia(\"(max-width: 992px)\").matches\r\n};\r\n\r\nif (\"cordova\" in window) {\r\n    document.addEventListener(\"deviceready\", onCordovaReady, false);\r\n}\r\n\r\nloadReport((report) => {\r\n    VM.settings = loadSettings();\r\n    VM.reportDate = report.date;\r\n    VM.reportRows = report.rows;\r\n\r\n    applySettings();\r\n\r\n    // tslint:disable-next-line:no-unused-expression\r\n    new Vue({\r\n        el: \"#\" + ROOT_ID,\r\n        data: VM,\r\n        watch: {\r\n            settings: {\r\n                deep: true,\r\n                handler: () => applySettings()\r\n            }\r\n        }\r\n    });\r\n\r\n    document.getElementById(ROOT_ID).style.display = \"\";\r\n    document.getElementById(\"bond-finder-loading\").style.display = \"none\";\r\n\r\n    adjustFont();\r\n    monitorResize(adjustFont);\r\n});\r\n\r\nfunction applySettings() {\r\n    saveSettings(VM.settings);\r\n\r\n    const settings = VM.settings;\r\n    const maturityHorizon = [ settings.year, settings.month, \"01\" ].join(\"-\");\r\n    const maxListLevel = Number(settings.maxListLevel);\r\n    const maxPerYear = Number(settings.maxPerYear);\r\n    const requiredCouponMonth = Number(settings.requiredCouponMonth);\r\n    const maxAmort = Number(settings.maxAmort);\r\n    const minTotalTradesPerc = Number(settings.minTotalTradesPerc);\r\n\r\n    const couponType = Number(settings.couponType);\r\n    const allowVarCoupon = couponType > 0;\r\n    const allowOffer = couponType > 1;\r\n\r\n    VM.hasFits = false;\r\n    VM.hasABI = false;\r\n    VM.showVarCouponNotice = false;\r\n    VM.showOfferNotice = false;\r\n\r\n    for (const row of VM.reportRows) {\r\n        row.fits = fits(row);\r\n        if (row.fits) {\r\n            VM.hasFits = true;\r\n            if (isVarCoupon(row)) {\r\n                VM.showVarCouponNotice = true;\r\n            }\r\n            if (hasOffer(row)) {\r\n                VM.showOfferNotice = true;\r\n            }\r\n            VM.hasABI = VM.hasABI || row.inABI;\r\n        }\r\n    }\r\n\r\n    function fits(row: IReportRow) {\r\n        if (maturityHorizon.length < 10 || row.maturityDate >= maturityHorizon) {\r\n            return false;\r\n        }\r\n\r\n        if (settings.sector1 || settings.sector2 || settings.sector3) {\r\n            if (row.sector === 1 && !settings.sector1) { return false; }\r\n            if (row.sector === 2 && !settings.sector2) { return false; }\r\n            if (row.sector === 3 && !settings.sector3) { return false; }\r\n        }\r\n\r\n        if (row.listLevel > maxListLevel) {\r\n            return false;\r\n        }\r\n\r\n        if (maxPerYear > -1) {\r\n            if (row.couponMonths[0] === -12) {\r\n                return false;\r\n            }\r\n            if (row.couponMonths.length > maxPerYear) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (requiredCouponMonth > 0) {\r\n            if (row.couponMonths.indexOf(requiredCouponMonth) < 0) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (!allowVarCoupon && isVarCoupon(row)) {\r\n            return false;\r\n        }\r\n\r\n        if (!allowOffer && hasOffer(row)) {\r\n            return false;\r\n        }\r\n\r\n        if (row.minDaysBetweenAmort > 0) {\r\n            if (maxAmort === -1) {\r\n                return false;\r\n            }\r\n            if (row.minDaysBetweenAmort < maxAmort) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (row.totalTradesPerc < minTotalTradesPerc) {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\nfunction onCordovaReady() {\r\n    document.addEventListener(\"resume\", onCordovaResume, false);\r\n}\r\n\r\nfunction onCordovaResume() {\r\n    if (Date.now() - LAUNCH_TIME > 1234 * 1000) {\r\n        location.reload();\r\n    }\r\n}\r\n","import Vue from \"vue\";\r\nimport IReportRow from \"./report-row\";\r\nimport { hasOffer, isVarCoupon } from \"./report-row-extensions\";\r\n\r\nconst PILL_BADGE_CLASS_PREFIX = \"badge badge-pill badge-\";\r\n\r\ninterface IContext {\r\n    row: IReportRow;\r\n}\r\n\r\nVue.component(\"bond-row\", {\r\n    props: [ \"row\" ],\r\n    template: \"#bond-row-template\",\r\n    computed: {\r\n\r\n        moexUrl(this: IContext) {\r\n            return \"https://www.moex.com/ru/issue.aspx?code=\" + this.row.isin;\r\n        },\r\n\r\n        sectorBadgeClass(this: IContext) {\r\n            switch (this.row.sector) {\r\n                case 1:\r\n                case 2:\r\n                    return PILL_BADGE_CLASS_PREFIX + \"success\";\r\n                case 3:\r\n                    return PILL_BADGE_CLASS_PREFIX + \"warning\";\r\n            }\r\n        },\r\n\r\n        sectorName(this: IContext) {\r\n            switch (this.row.sector) {\r\n                case 1: return \"ОФЗ\";\r\n                case 2: return \"Муни\";\r\n                case 3: return \"Корп\";\r\n            }\r\n        },\r\n\r\n        listLevelBadgeClass(this: IContext) {\r\n            switch (this.row.listLevel) {\r\n                case 1: return PILL_BADGE_CLASS_PREFIX + \"success\";\r\n                case 2: return PILL_BADGE_CLASS_PREFIX + \"warning\";\r\n                case 3: return PILL_BADGE_CLASS_PREFIX + \"danger\";\r\n            }\r\n        },\r\n\r\n        listLevelName(this: IContext) {\r\n            switch (this.row.listLevel) {\r\n                case 1: return \"I\";\r\n                case 2: return \"II\";\r\n                case 3: return \"III\";\r\n            }\r\n        },\r\n\r\n        showCouponStar(this: IContext) {\r\n            return isVarCoupon(this.row)\r\n                || hasOffer(this.row);\r\n        }\r\n    }\r\n});\r\n","import IReportRow from \"./report-row\";\r\n\r\nconst REPORT_URL = \"https://bond-finder-lab.github.io/backend/report-v1.json?_=\" + Date.now();\r\n\r\ninterface IReport {\r\n    date: string;\r\n    rows: ReadonlyArray<IReportRow>;\r\n}\r\n\r\nfunction convert(source: any): IReport {\r\n    const cols = source.cols as string[];\r\n    const rows = source.rows as any[];\r\n\r\n    const indexOf: { [jsonKey: string]: number } = {};\r\n    for (const name of cols) {\r\n        indexOf[name] = cols.indexOf(name);\r\n    }\r\n\r\n    return {\r\n        date: String(source.date),\r\n        rows: rows.map((r) => ({\r\n            isin: String(r[indexOf.isin]),\r\n            name: String(r[indexOf.name]),\r\n            sector: Number(r[indexOf.sector]),\r\n            listLevel: Number(r[indexOf.list_level]),\r\n            totalTradesPerc: Number(r[indexOf.total_trades_perc]),\r\n            maturityDate: String(r[indexOf.maturity_date]),\r\n            minDaysBetweenAmort: Number(r[indexOf.min_days_between_amort]),\r\n            couponMonths: r[indexOf.coupon_months] as number[],\r\n            couponValues: r[indexOf.coupon_values] as number[],\r\n            closeYield: Number(r[indexOf.close_yield]),\r\n            inABI: Boolean(r[indexOf.in_abi]),\r\n            fits: false\r\n        }))\r\n    };\r\n}\r\n\r\nexport default (callback: (report: IReport) => void) => {\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open(\"GET\", REPORT_URL, true);\r\n    xhr.timeout = 10 * 1000;\r\n\r\n    function handleError() {\r\n        alert(\"Не удалось загрузить данные. Мож инет отвалился?..\");\r\n        location.reload();\r\n    }\r\n\r\n    xhr.onreadystatechange = function() {\r\n      if (this.readyState === 4) {\r\n        if (this.status === 200) {\r\n            try {\r\n                callback(convert(JSON.parse(this.responseText)));\r\n            } catch {\r\n                handleError();\r\n            }\r\n        } else {\r\n            handleError();\r\n        }\r\n      }\r\n    };\r\n\r\n    xhr.send();\r\n};\r\n","const STORAGE_KEY = \"bond-finder-settings-v1\";\r\n\r\nexport interface ISettings {\r\n    month: string;\r\n    year: string;\r\n    sector1: boolean;\r\n    sector2: boolean;\r\n    sector3: boolean;\r\n    maxListLevel: string;\r\n    maxPerYear: string;\r\n    requiredCouponMonth: string;\r\n    couponType: string;\r\n    maxAmort: string;\r\n    minTotalTradesPerc: string;\r\n}\r\n\r\nconst DEFAULT_SETTINGS: ISettings = {\r\n    month: \"01\",\r\n    year: String(new Date().getFullYear() + 4),\r\n    sector1: true,\r\n    sector2: true,\r\n    sector3: true,\r\n    maxListLevel: \"2\",\r\n    maxPerYear: \"4\",\r\n    requiredCouponMonth: \"0\",\r\n    couponType: \"0\",\r\n    maxAmort: \"90\",\r\n    minTotalTradesPerc: \"50\"\r\n};\r\n\r\nexport function load(): ISettings {\r\n    const result = { ...DEFAULT_SETTINGS };\r\n    let storedSettings: any;\r\n\r\n    try {\r\n        storedSettings = JSON.parse(localStorage.getItem(STORAGE_KEY));\r\n    } catch {\r\n        // mute\r\n    }\r\n\r\n    if (storedSettings && typeof storedSettings === \"object\") {\r\n        for (const key of Object.keys(DEFAULT_SETTINGS)) {\r\n            if (key in storedSettings) {\r\n                result[key] = storedSettings[key];\r\n            }\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nexport function save(settings: ISettings) {\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));\r\n}\r\n","const html = document.documentElement;\r\nconst GUTTERS = 40; // 2 * 1.25em\r\n\r\nexport default function() {\r\n    const helperElement = document.getElementById(\"adjust-font-helper\");\r\n\r\n    html.style.fontSize = \"100%\";\r\n\r\n    const containerWidth = helperElement.parentElement.clientWidth - GUTTERS;\r\n    const helperWidth = helperElement.scrollWidth;\r\n\r\n    if (containerWidth < helperWidth) {\r\n        html.style.fontSize = (100 * containerWidth / helperWidth) + \"%\";\r\n    }\r\n}\r\n","const html = document.documentElement;\r\nconst callbacks = [ ];\r\n\r\nlet prevW = html.clientWidth;\r\n\r\nfunction onResize() {\r\n    const w = html.clientWidth;\r\n    if (w !== prevW) {\r\n        prevW = w;\r\n        for (const callback of callbacks) {\r\n            callback();\r\n        }\r\n    }\r\n}\r\n\r\naddEventListener(\"resize\", onResize);\r\n\r\nexport default function(callback) {\r\n    callbacks.push(callback);\r\n}\r\n"],"sourceRoot":""}