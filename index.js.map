{"version":3,"sources":["webpack:///./src/bond-row-component.ts","webpack:///./src/index.ts","webpack:///./src/load-report.ts","webpack:///./src/report-row-extensions.ts","webpack:///./src/settings.ts","webpack:///./src/storageUtil.ts","webpack:///external \"{ default: Vue }\"","webpack:///webpack/bootstrap","webpack:///webpack/startup"],"names":["component","props","template","computed","moexUrl","this","row","isin","sectorBadgeClass","sector","PILL_BADGE_CLASS_PREFIX","sectorName","listLevelBadgeClass","listLevel","isHighRisk","listLevelName","showCouponStar","isVarCoupon","hasOffer","LAUNCH_TIME","Date","now","ROOT_ID","IS_CORDOVA","window","ALERT_DISMISS_KEY","VM","collapseForm","matchMedia","matches","applySettings","save","settings","maturityHorizon","year","month","join","maxListLevel","Number","maxPerYear","requiredCouponMonth","maxAmort","minTotalTradesPerc","couponType","allowVarCoupon","allowOffer","totalFits","hasABI","hasCBHY","hasHighRisk","hasQualOnly","showVarCouponNotice","showOfferNotice","reportRows","fits","top","inABI","inCBHY","isQualOnly","highRisk","length","maturityDate","sector1","sector2","sector3","couponMonths","indexOf","minDaysBetweenAmort","totalTradesPerc","showAll","onCordovaResume","location","reload","document","addEventListener","MobileAccessibility","usePreferredTextZoom","e","a","target","tagName","href","kind","storageKey","load","confirm","confirmExternalLink","preventDefault","stopPropagation","report","reportDate","date","rows","html","reportError","error","showAlert","el","data","watch","deep","handler","methods","alertClose","getElementById","style","display","documentElement","fontSize","parseFloat","getComputedStyle","REPORT_URL","CACHE_KEY","callback","xhr","XMLHttpRequest","handleResponseText","responseText","source","cols","String","map","r","name","list_level","total_trades_perc","maturity_date","min_days_between_amort","coupon_months","couponValues","coupon_values","closeYield","close_yield","Boolean","in_abi","in_cbhy","high_risk","qual","convert","JSON","parse","open","timeout","onreadystatechange","readyState","status","send","v","STORAGE_KEY","DEFAULT_SETTINGS","getFullYear","result","storedSettings","Object","keys","key","getStorageKey","json","value","localStorage","getItem","setItem","stringify","module","exports","default","Vue","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","call"],"mappings":"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","file":"index.js","sourcesContent":["import Vue from \"vue\";\r\nimport IReportRow from \"./report-row\";\r\nimport { hasOffer, isVarCoupon } from \"./report-row-extensions\";\r\n\r\nconst PILL_BADGE_CLASS_PREFIX = \"badge badge-pill badge-\";\r\n\r\ninterface IContext {\r\n    row: IReportRow;\r\n}\r\n\r\nVue.component(\"bond-row\", {\r\n    props: [ \"row\" ],\r\n    template: \"#bond-row-template\",\r\n    computed: {\r\n\r\n        moexUrl(this: IContext) {\r\n            return \"https://www.moex.com/ru/issue.aspx?code=\" + this.row.isin;\r\n        },\r\n\r\n        sectorBadgeClass(this: IContext) {\r\n            switch (this.row.sector) {\r\n                case 1:\r\n                case 2:\r\n                    return PILL_BADGE_CLASS_PREFIX + \"success\";\r\n                case 3:\r\n                    return PILL_BADGE_CLASS_PREFIX + \"warning\";\r\n            }\r\n        },\r\n\r\n        sectorName(this: IContext) {\r\n            switch (this.row.sector) {\r\n                case 1: return \"ОФЗ\";\r\n                case 2: return \"Муни\";\r\n                case 3: return \"Корп\";\r\n            }\r\n        },\r\n\r\n        listLevelBadgeClass(this: IContext) {\r\n            const row = this.row;\r\n            switch (row.listLevel) {\r\n                case 1: return PILL_BADGE_CLASS_PREFIX + \"success\";\r\n                case 2: return PILL_BADGE_CLASS_PREFIX + \"warning\";\r\n                case 3: return row.isHighRisk\r\n                    ? PILL_BADGE_CLASS_PREFIX + \"dark bond-finder-ir-badge\"\r\n                    : PILL_BADGE_CLASS_PREFIX + \"danger\";\r\n            }\r\n        },\r\n\r\n        listLevelName(this: IContext) {\r\n            const row = this.row;\r\n            switch (row.listLevel) {\r\n                case 1: return \"I\";\r\n                case 2: return \"II\";\r\n                case 3: return row.isHighRisk\r\n                    ? \"\\xa0\"\r\n                    : \"III\";\r\n            }\r\n        },\r\n\r\n        showCouponStar(this: IContext) {\r\n            return isVarCoupon(this.row)\r\n                || hasOffer(this.row);\r\n        }\r\n    }\r\n});\r\n","import Vue from \"vue\";\r\nimport \"./bond-row-component\";\r\nimport loadReport from \"./load-report\";\r\nimport IReportRow from \"./report-row\";\r\nimport { hasOffer, isVarCoupon } from \"./report-row-extensions\";\r\nimport { ISettings, load as loadSettings, save as saveSettings } from \"./settings\";\r\nimport storageUtil from \"./storageUtil\";\r\n\r\ninterface IViewModel {\r\n    settings?: ISettings;\r\n    reportDate?: string;\r\n    reportRows?: ReadonlyArray<IReportRow>;\r\n    reportError?: boolean;\r\n    totalFits?: number;\r\n    showAll?: boolean;\r\n    hasABI?: boolean;\r\n    hasCBHY?: boolean;\r\n    hasHighRisk?: boolean;\r\n    hasQualOnly?: boolean;\r\n    collapseForm?: boolean;\r\n    showVarCouponNotice?: boolean;\r\n    showOfferNotice?: boolean;\r\n    showAlert?: boolean;\r\n}\r\n\r\nconst LAUNCH_TIME = Date.now();\r\nconst ROOT_ID = \"vue-root\";\r\nconst IS_CORDOVA = \"cordova\" in window;\r\nconst ALERT_DISMISS_KEY = \"alert-v1\";\r\n\r\nconst VM: IViewModel = {\r\n    collapseForm: window.matchMedia && window.matchMedia(\"(max-width: 992px)\").matches\r\n};\r\n\r\nif (IS_CORDOVA) {\r\n    document.addEventListener(\"deviceready\", onCordovaReady, false);\r\n    document.addEventListener(\"DOMContentLoaded\", onDOMContentLoaded, false);\r\n}\r\n\r\nloadReport((report) => {\r\n    VM.settings = loadSettings();\r\n    VM.reportDate = report.date;\r\n    VM.reportRows = report.rows;\r\n\r\n    const reportError = report.error;\r\n    VM.reportError = reportError;\r\n    VM.showAlert = !reportError && !storageUtil.load(ALERT_DISMISS_KEY);\r\n\r\n    applySettings();\r\n\r\n    // tslint:disable-next-line:no-unused-expression\r\n    new Vue({\r\n        el: \"#\" + ROOT_ID,\r\n        data: VM,\r\n        watch: {\r\n            settings: {\r\n                deep: true,\r\n                handler: () => applySettings()\r\n            }\r\n        },\r\n        methods: {\r\n            alertClose: () => storageUtil.save(ALERT_DISMISS_KEY, true)\r\n        }\r\n    });\r\n\r\n    document.getElementById(ROOT_ID).style.display = \"\";\r\n    document.getElementById(\"bond-finder-loading\").style.display = \"none\";\r\n\r\n    if (!IS_CORDOVA) {\r\n        initFontSize();\r\n    }\r\n});\r\n\r\nfunction applySettings() {\r\n    saveSettings(VM.settings);\r\n\r\n    const settings = VM.settings;\r\n    const maturityHorizon = [ settings.year, settings.month, \"01\" ].join(\"-\");\r\n    const maxListLevel = Number(settings.maxListLevel);\r\n    const maxPerYear = Number(settings.maxPerYear);\r\n    const requiredCouponMonth = Number(settings.requiredCouponMonth);\r\n    const maxAmort = Number(settings.maxAmort);\r\n    const minTotalTradesPerc = Number(settings.minTotalTradesPerc);\r\n\r\n    const couponType = Number(settings.couponType);\r\n    const allowVarCoupon = couponType > 0;\r\n    const allowOffer = couponType > 1;\r\n\r\n    const TOP = 20;\r\n    const MAX = 1000;\r\n\r\n    let totalFits = 0;\r\n    let hasABI = false;\r\n    let hasCBHY = false;\r\n    let hasHighRisk = false;\r\n    let hasQualOnly = false;\r\n    let showVarCouponNotice = false;\r\n    let showOfferNotice = false;\r\n\r\n    for (const row of VM.reportRows) {\r\n        if (fits(row)) {\r\n            totalFits++;\r\n            row.fits = true;\r\n            row.top = totalFits <= TOP;\r\n            showVarCouponNotice = showVarCouponNotice || isVarCoupon(row);\r\n            showOfferNotice = showOfferNotice || hasOffer(row);\r\n            hasABI = hasABI || row.inABI;\r\n            hasCBHY = hasCBHY || row.inCBHY;\r\n            hasHighRisk = hasHighRisk || row.isHighRisk;\r\n            hasQualOnly = hasQualOnly || row.isQualOnly;\r\n        } else {\r\n            row.fits = row.top = false;\r\n        }\r\n        if (totalFits >= MAX) {\r\n            break;\r\n        }\r\n    }\r\n\r\n    VM.totalFits = totalFits;\r\n    VM.showAll = totalFits / TOP < 1.5;\r\n    VM.hasABI = hasABI;\r\n    VM.hasCBHY = hasCBHY;\r\n    VM.hasHighRisk = hasHighRisk;\r\n    VM.hasQualOnly = hasQualOnly;\r\n    VM.showVarCouponNotice = showVarCouponNotice;\r\n    VM.showOfferNotice = showOfferNotice;\r\n\r\n    function fits(row: IReportRow) {\r\n        if (row.isHighRisk && !settings.highRisk) {\r\n            return false;\r\n        }\r\n\r\n        if (maturityHorizon.length < 10 || row.maturityDate >= maturityHorizon) {\r\n            return false;\r\n        }\r\n\r\n        if (settings.sector1 || settings.sector2 || settings.sector3) {\r\n            if (row.sector === 1 && !settings.sector1) { return false; }\r\n            if (row.sector === 2 && !settings.sector2) { return false; }\r\n            if (row.sector === 3 && !settings.sector3) { return false; }\r\n        }\r\n\r\n        if (row.listLevel > maxListLevel) {\r\n            return false;\r\n        }\r\n\r\n        if (maxPerYear > -1) {\r\n            if (row.couponMonths[0] === -12) {\r\n                return false;\r\n            }\r\n            if (row.couponMonths.length > maxPerYear) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (requiredCouponMonth > 0) {\r\n            if (row.couponMonths.indexOf(requiredCouponMonth) < 0) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (!allowVarCoupon && isVarCoupon(row)) {\r\n            return false;\r\n        }\r\n\r\n        if (!allowOffer && hasOffer(row)) {\r\n            return false;\r\n        }\r\n\r\n        if (row.minDaysBetweenAmort > 0) {\r\n            if (maxAmort === -1) {\r\n                return false;\r\n            }\r\n            if (row.minDaysBetweenAmort < maxAmort) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (row.totalTradesPerc < minTotalTradesPerc) {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\nfunction onCordovaReady() {\r\n    document.addEventListener(\"resume\", onCordovaResume, false);\r\n    (window as any).MobileAccessibility.usePreferredTextZoom(false);\r\n}\r\n\r\nfunction onCordovaResume() {\r\n    if (Date.now() - LAUNCH_TIME > 1234 * 1000) {\r\n        location.reload();\r\n    }\r\n}\r\n\r\nfunction initFontSize() {\r\n    const html = document.documentElement;\r\n    html.style.fontSize = \"medium\";\r\n    html.style.fontSize = 1600 / parseFloat(getComputedStyle(html).fontSize) + \"%\";\r\n}\r\n\r\nfunction onDOMContentLoaded() {\r\n    document.addEventListener(\"click\", (e) => {\r\n        const a = e.target as HTMLAnchorElement;\r\n        if (a.tagName === \"A\" && !confirmExternalLink(a.href)) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n        }\r\n    }, false);\r\n}\r\n\r\nfunction confirmExternalLink(href: string) {\r\n    if (!href) {\r\n        return true;\r\n    }\r\n\r\n    const kind = href.indexOf(\"moex.com/\") > -1 ? \"moex\" : \"other\";\r\n    const storageKey = \"confirm-external-link-\" + kind;\r\n\r\n    if (!storageUtil.load(storageKey)) {\r\n        const subj = kind === \"moex\"\r\n            ? \"сайт Московской Биржи\"\r\n            : \"внешний сайт\";\r\n        if (!confirm(\"Пожалуйста, подтвердите переход на \" + subj)) {\r\n            return false;\r\n        }\r\n        storageUtil.save(storageKey, \"1\");\r\n    }\r\n\r\n    return true;\r\n}\r\n","import IReportRow from \"./report-row\";\r\nimport storageUtil from \"./storageUtil\";\r\n\r\nconst REPORT_URL = \"https://bond-finder-lab.github.io/backend/report-v1.json?_=\" + Date.now();\r\nconst CACHE_KEY = \"report-cache-v1\";\r\n\r\ninterface IReport {\r\n    date: string;\r\n    rows: ReadonlyArray<IReportRow>;\r\n    error?: boolean;\r\n}\r\n\r\nfunction convert(source: any): IReport {\r\n    const cols = source.cols as string[];\r\n    const rows = source.rows as any[];\r\n\r\n    const indexOf: { [jsonKey: string]: number } = {};\r\n    for (const name of cols) {\r\n        indexOf[name] = cols.indexOf(name);\r\n    }\r\n\r\n    return {\r\n        date: String(source.date),\r\n        rows: rows.map((r) => ({\r\n            isin: String(r[indexOf.isin]),\r\n            name: String(r[indexOf.name]),\r\n            sector: Number(r[indexOf.sector]),\r\n            listLevel: Number(r[indexOf.list_level]),\r\n            totalTradesPerc: Number(r[indexOf.total_trades_perc]),\r\n            maturityDate: String(r[indexOf.maturity_date]),\r\n            minDaysBetweenAmort: Number(r[indexOf.min_days_between_amort]),\r\n            couponMonths: r[indexOf.coupon_months] as number[],\r\n            couponValues: r[indexOf.coupon_values] as number[],\r\n            closeYield: Number(r[indexOf.close_yield]),\r\n            inABI: Boolean(r[indexOf.in_abi]),\r\n            inCBHY: Boolean(r[indexOf.in_cbhy]),\r\n            isHighRisk: Boolean(r[indexOf.high_risk]),\r\n            isQualOnly: Boolean(r[indexOf.qual]),\r\n            fits: false,\r\n            top: false\r\n        }))\r\n    };\r\n}\r\n\r\nexport default (callback: (report: IReport) => void) => {\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open(\"GET\", REPORT_URL, true);\r\n    xhr.timeout = 10 * 1000;\r\n\r\n    function handleResponseText(responseText: string) {\r\n        try {\r\n            callback(convert(JSON.parse(responseText)));\r\n        } catch {\r\n            callback({ error: true, date: null, rows: [ ] });\r\n        }\r\n    }\r\n\r\n    xhr.onreadystatechange = function() {\r\n      if (this.readyState === 4) {\r\n        if (this.status === 200) {\r\n            const { responseText } = this;\r\n            storageUtil.save(CACHE_KEY, responseText);\r\n            handleResponseText(responseText);\r\n        } else {\r\n            handleResponseText(storageUtil.load(CACHE_KEY));\r\n        }\r\n      }\r\n    };\r\n\r\n    xhr.send();\r\n};\r\n","import IReportRow from \"./report-row\";\r\n\r\nexport function isVarCoupon(row: IReportRow) {\r\n    return row.couponValues.length > 1\r\n        || row.name.indexOf(\"ОФЗ-ПК \") === 0;\r\n}\r\n\r\nexport function hasOffer(row: IReportRow) {\r\n    const v = row.couponValues;\r\n    return v[v.length - 1] === null;\r\n}\r\n","import storageUtil from \"./storageUtil\";\r\n\r\nconst STORAGE_KEY = \"settings-v1\";\r\n\r\nexport interface ISettings {\r\n    month: string;\r\n    year: string;\r\n    sector1: boolean;\r\n    sector2: boolean;\r\n    sector3: boolean;\r\n    highRisk: boolean;\r\n    maxListLevel: string;\r\n    maxPerYear: string;\r\n    requiredCouponMonth: string;\r\n    couponType: string;\r\n    maxAmort: string;\r\n    minTotalTradesPerc: string;\r\n}\r\n\r\nconst DEFAULT_SETTINGS: ISettings = {\r\n    month: \"01\",\r\n    year: String(new Date().getFullYear() + 4),\r\n    sector1: true,\r\n    sector2: true,\r\n    sector3: true,\r\n    highRisk: true,\r\n    maxListLevel: \"2\",\r\n    maxPerYear: \"4\",\r\n    requiredCouponMonth: \"0\",\r\n    couponType: \"0\",\r\n    maxAmort: \"90\",\r\n    minTotalTradesPerc: \"50\"\r\n};\r\n\r\nexport function load(): ISettings {\r\n    const result = { ...DEFAULT_SETTINGS };\r\n    const storedSettings = storageUtil.load(STORAGE_KEY, true);\r\n\r\n    if (storedSettings && typeof storedSettings === \"object\") {\r\n        for (const key of Object.keys(DEFAULT_SETTINGS)) {\r\n            if (key in storedSettings) {\r\n                result[key] = storedSettings[key];\r\n            }\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nexport function save(settings: ISettings) {\r\n    storageUtil.save(STORAGE_KEY, settings, true);\r\n}\r\n","function getStorageKey(key: string) {\r\n    return \"bond-finder-\" + key;\r\n}\r\n\r\nfunction load(key: string, json = false) {\r\n    try {\r\n        const value = localStorage.getItem(getStorageKey(key));\r\n        return json ? JSON.parse(value) : value;\r\n    } catch {\r\n        return null;\r\n    }\r\n}\r\n\r\nfunction save(key: string, value: any, json = false) {\r\n    try {\r\n        localStorage.setItem(\r\n            getStorageKey(key),\r\n            (json ? JSON.stringify : String)(value)\r\n        );\r\n    } catch {\r\n        // mute\r\n    }\r\n}\r\n\r\nexport default { load, save };\r\n","module.exports = { default: Vue };","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module\n__webpack_require__(607);\n// This entry module used 'exports' so it can't be inlined\n"],"sourceRoot":""}